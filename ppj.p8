pico-8 cartridge // http://www.pico-8.com
version 36
__lua__
-- init

-- constants
gravity = 0.2
friction = 0.85

function _init()
	player = {
			sp=1,
			x=59,
			y=59,
			w=8,
			h=8,
			flipped=false,
			dx=0,
			dy=0,
			max_dx=2,
			max_dy=3,
			acc=0.5,
			jp=3.5,
			anim=0,
			running=false,
			jumping=false,
			falling=false,
			sliding=false,
			landed=false
	}

end
-->8
-- update
function _update60()
	player_update()
	player_animate()
end

function player_update()
	-- physics
	player.dy+=gravity
	player.dx*=friction
	
	-- controls
	if btn(0) then
		player.dx-=player.acc
		player.running=true
		player.flipped=true
	end
	if btn(1) then
		player.dx+=player.acc
		player.running=true
		player.flipped=false
	end
	
	-- slide
	if player.running
	and not btn(0)
	and not btn(1)
	and not player.falling
	and not player.jumping then
		player.running=false
		player.sliding=true
	end
	
	-- jump
	if btnp(2)
	and player.landed then
		player.dy-=player.jp
		player.landed=false
	end
	
	-- check collision up/down
	if player.dy>0 then
		player.falling=true
		player.landed=false
		player.jumping=false
		
		player.dy=limit_speed(player.dy,player.max_dy)
		
		if collide_map(player,"down",0) then
			player.landed=true
			player.falling=false
			player.dy=0
			player.y-=((player.y+player.h+1)%8)-1
		end
	elseif player.dy<0 then
		player.jumping=true
		if collide_map(player,"up",1) then
			player.dy=0
		end
	end
	
	-- check collision left/right
	if player.dx<0 then
	
		player.dx=limit_speed(player.dx,player.max_dx)
	
		if collide_map(player,"left",1) then
			player.dx=0
		end
	elseif player.dx>0 then
	
		player.dx=limit_speed(player.dx,player.max_dx)
		
		if collide_map(player,"right",1) then
			player.dy=0
		end
	end
	
	-- stop sliding
	if player.sliding then
		if abs(player.dx)<.2
		or player.running then
			player.dx=0
			player.sliding=false
		end
	end
	
	player.x+=player.dx
	player.y+=player.dy
end

function player_animate()
	if player.jumping then
		player.sp=6
	elseif player.falling then
		player.sp=7
	elseif player.sliding then
		player.sp=8
	elseif player.running then
		if time()-player.anim>.1 then
			player.anim=time()
			player.sp+=1
			if player.sp>5 then
				player.sp=2
			end
		end
	else -- idle
		if time()-player.anim>.3 then
			player.anim=time()
			player.sp+=1
			if player.sp>1 then
				player.sp=0
			end
		end
	end
end

function limit_speed(num,maximum)
	return mid(-maximum,num,maximum)
end
-->8
-- draw
function _draw()
	cls()
	map(0,0)
	spr(player.sp,player.x,player.y,1,1,player.flipped)
end
-->8
-- collisions

function collide_map(obj,dir,flag)
	-- obj = {x,y,w,h}
	-- dir = left,right,up,down
	
	local x=obj.x
	local y=obj.y
	local w=obj.w
	local h=obj.h
	
	local x1=0
	local x2=0
	local y1=0
	local y2=0
	
	if (dir == "left") then
		x1=x-1 			y1=y
		x2=x 					y2=y+h-1
	elseif (dir == "left") then
		x1=x+w 			y1=y
		x2=x+w+1		y2=y+h-1
	elseif (dir == "up") then
		x1=x+1 			y1=y-1
		x2=x+w-1 	y2=y
	elseif (dir == "down") then
		x1=x 					y1=y+h
		x2=x+w 			y2=y+h
	end
	
	-- pixels to tiles
	x1/=8
	x2/=8
	y1/=8
	y2/=8
	
	if fget(mget(x1,y1),flag)
	or fget(mget(x1,y2),flag)
	or fget(mget(x2,y1),flag)
	or fget(mget(x2,y2),flag) then
		return true
	else
		return false
	end
		 
end
__gfx__
01111110011111100001111100011111000111110001111100011111600111110000000000000000000000000000000000000000000000000000000000000000
06666660066666600666666606066666600666660606666600666666066666660111111000000000000000000000000000000000000000000000000000000000
61f74f4061f74f40600ff74f606ff74f066ff74f606ff74f060ff74f000ff74f0666666000000000000000000000000000000000000000000000000000000000
01fffff001fffef0000ffffe000ffffe000ffffe000ffffe600ffffe000ffffe61f74f4000000000000000000000000000000000000000000000000000000000
00011000001111000f1110000f1110000f1110000f111000001110000000111001fffef000000000000000000000000000000000000000000000000000000000
001111000f0110f0000110000001100000011000000110000f0110000000110f0011111f00000000000000000000000000000000000000000000000000000000
0f0dd0f0000dd0000110d000001d00000dd0100000d1000000d10000000001d00f011d0000000000000000000000000000000000000000000000000000000000
00100d0000100d000000d000001d00000000100000d100000d1000000000001d000011dd00000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00665600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06555600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00655560000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00656600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
088888880ccccccc0444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09999999077777770777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
98feffe87cfbffbc74f2ff2400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08fffff80cfffffc04fffff400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0088880000cccc000044440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
088888800cccccc00444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
009999000077770000ffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0080080000c00c000040040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00009000000070000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
009989000077c7000066460000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0988890007ccc7000644460000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00988890007ccc700064446000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00989900007c77000064660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00090000000700000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb00bbbbbbbbb3bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000
3bbb3bbbbbbb3bbb3bb3babbb33bbb3b0bbbbb3bbbbbbb3000000000000000000000000000000000000000000000000000000000000000000000000000000000
33b333b33bb33bb333b333b3b3bb33b3b33b3343b33b3bb300000000000000000000000000000000000000000000000000000000000000000000000000000000
4b3444343b334333443b43b44433b3a3bbb334443434bbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000
4b3424443b34444344334444843444b4bb344444346443b300000000000000000000000000000000000000000000000000000000000000000000000000000000
43444444434494444444244444244444b344464a444443bb00000000000000000000000000000000000000000000000000000000000000000000000000000000
44444d44444444f44e4444444444c444bb44d4444494443b00000000000000000000000000000000000000000000000000000000000000000000000000000000
4a44444444d44444444444f444444444334444444444443300000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333334444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbb3bbbbb3bbbbb9999499999499999000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbb3bbbbbbb3bbbb9994999999949999000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333334444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b3bbbb3bbbbbbb3b9499994999999949000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb3bbb3bbbbbb3bb9949994999999499000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333334444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
003bb300000000000049940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
003bb300003bb3000049940000499400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0033b300003bb3000044940000499400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
003bb300003bb3000049940000499400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
003bb300003333000049940000444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
003bb300003bb3000049940000499400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
003b3300003bb3000049440000499400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
003bb300003bb3000049940000499400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
003bb300003bb3000049940000499400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000bbb0000444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08888888000990000bbbbbbb04766640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0008880005999770000bbb0004666740000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000bbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003030303030300000000000000000000030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0061000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0061000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6161005352535300000000005051515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6161000063000000000000006100006100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6161000063000000505150006100006100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6161000063000000610061005051515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6161005253520000610061006100006100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6161006200620000610061006100006100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041434241434142414240434241414200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
